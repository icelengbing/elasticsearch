[[indices-update-settings]]
== 更新索引设置

实时更改指定索引设置。

可以使用 REST 端点 `/_settings`（更新所有索引）或 `{index}/_settings` 更新一个（或多个）索引的设置。要更新的设置在请求正文中，例如：

[source,js]
--------------------------------------------------
PUT /twitter/_settings
{
    "index" : {
        "number_of_replicas" : 2
    }
}
--------------------------------------------------
// CONSOLE
// TEST[setup:twitter]

要将设置重置为默认值，可以使用 `null`。例如：

[source,js]
--------------------------------------------------
PUT /twitter/_settings
{
    "index" : {
        "refresh_interval" : null
    }
}
--------------------------------------------------
// CONSOLE
// TEST[setup:twitter]

能在索引上动态更新的设置列表可以在 <<index-modules>> 中找到。如果要保持现有设置不被更新，可以将请求参数 `preserve_existing` 设置为 `true`。

[float]
[[bulk]]
=== 批量索引用法

可以使用更新设置 API 动态地更改索引设置，使其更适合批量索引，完成后再将其改为实时索引设置。例如，在批量索引开始之前，使用：

[source,js]
--------------------------------------------------
PUT /twitter/_settings
{
    "index" : {
        "refresh_interval" : "-1"
    }
}
--------------------------------------------------
// CONSOLE
// TEST[setup:twitter]

（另一个优化方法是不带副本启动索引，然后再添加副本，但使用场景要依据实际情况而定）。

然后，一旦完成批量索引，就可以更新设置（例如，改回到默认值）：

[source,js]
--------------------------------------------------
PUT /twitter/_settings
{
    "index" : {
        "refresh_interval" : "1s"
    }
}
--------------------------------------------------
// CONSOLE
// TEST[continued]

然后，再调用强制合并：

[source,js]
--------------------------------------------------
POST /twitter/_forcemerge?max_num_segments=5
--------------------------------------------------
// CONSOLE
// TEST[continued]

[float]
[[update-settings-analysis]]
=== 更新索引分析

也可以为索引定义新的 <<analysis,分词器>>。但是需要先 <<indices-open-close,关闭>> 索引，在更改生效后再重新 <<indices-open-close,打开>>。

例如，如果未在 `myindex` 上定义 `content` 分词器，可以使用以下命令添加：

[source,js]
--------------------------------------------------
POST /twitter/_close

PUT /twitter/_settings
{
  "analysis" : {
    "analyzer":{
      "content":{
        "type":"custom",
        "tokenizer":"whitespace"
      }
    }
  }
}

POST /twitter/_open
--------------------------------------------------
// CONSOLE
// TEST[setup:twitter]
